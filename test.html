<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JQCdN v10.2.0 Test Suite</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/gtref/JQCdNv10.1.0@Version10.2.0/jqcdn.css">
    <script src="https://cdn.jsdelivr.net/gh/gtref/JQCdNv10.1.0@Version10.2.0/jqcdn.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; }
        #results { border: 1px solid #ccc; padding: 10px; margin-top: 20px; }
        .test-result { margin: 5px; padding: 10px; border-radius: 5px; border: 1px solid; }
        .pass { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        h1, h2 { border-bottom: 1px solid #eee; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>JQCdN v10.2.0 Test Suite</h1>
    <div id="test-fixture" style="display:none;">
        <div id="el1" class="foo bar">
            <p class="child">Child 1</p>
            <span class="child">Child 2</span>
            <div class="foo-nested">
                <p id="nested-p">Nested</p>
            </div>
        </div>
        <div id="el2" class="foo">Sibling</div>
        <button id="test-btn">Click Me</button>
        <div id="delegation-test"><button class="delegated-btn">Delegated</button></div>
        <div id="template-target"></div>
        <div id="ajax-target"></div>
        <input id="test-input" value="initial">
    </div>
    <h2>Results:</h2>
    <div id="results"></div>

    <script>
        $(async function() {
            const resultsContainer = $('#results');
            let testsPassed = 0;
            let testsFailed = 0;

            async function runTest(description, testFn) {
                const resultDiv = $('<div class="test-result"></div>');
                try {
                    const passed = await Promise.resolve(testFn());
                    if (passed) {
                        resultDiv.addClass('pass').text(`PASS: ${description}`);
                        testsPassed++;
                    } else { throw new Error('Assertion failed'); }
                } catch (e) {
                    resultDiv.addClass('fail').text(`FAIL: ${description} | Error: ${e.message}`);
                    testsFailed++;
                }
                resultsContainer.append(resultDiv);
            }

            // --- Test Cases ---

            await runTest('Selector selects by ID', () => $('#el1').length === 1);
            await runTest('Selector selects by class', () => $('.foo').length === 2);
            await runTest('.first() selects the first element', () => $('.foo').first().elements[0].id === 'el1');
            await runTest('.last() selects the last element', () => $('.foo').last().elements[0].id === 'el2');
            await runTest('.is() checks if an element matches a selector', () => $('#el1').is('.foo'));

            await runTest('.addClass() adds a class', () => {
                const el = $('#el1').addClass('new-class');
                return el.elements[0].classList.contains('new-class');
            });
            await runTest('.toggleClass() toggles a class', () => {
                const el = $('#el1').toggleClass('bar');
                return !el.elements[0].classList.contains('bar');
            });

            await runTest('.html() sets and gets HTML', () => {
                const el = $('#el2').html('<span>New</span>');
                return el.html() === '<span>New</span>';
            });
            await runTest('.text() sets and gets text', () => {
                const el = $('#el2').text('New Text');
                return el.text() === 'New Text';
            });
            await runTest('.attr() sets and gets an attribute', () => {
                const el = $('#el2').attr('data-test', 'value');
                return el.attr('data-test') === 'value';
            });
            await runTest('.val() sets and gets a value', () => {
                const input = $('#test-input').val('new value');
                return input.val() === 'new value';
            });

            await runTest('.append() adds content', () => {
                const el = $('#template-target').html('').append('<span>1</span>');
                return el.children().length === 1;
            });
            await runTest('.remove() removes an element', () => {
                $('#el2').remove();
                return $('#el2').length === 0;
            });
            await runTest('.empty() empties an element', () => {
                const el = $('#el1').empty();
                return el.children().length === 0;
            });

            await runTest('.on() attaches a direct click listener', () => {
                let clicked = false;
                $('#test-btn').on('click', () => { clicked = true; });
                $('#test-btn').elements[0].click();
                return clicked;
            });
            await runTest('.on() handles event delegation', () => {
                let clicked = false;
                $('#delegation-test').on('click', '.delegated-btn', () => { clicked = true; });
                $('.delegated-btn').elements[0].click();
                return clicked;
            });

            await runTest('.parent() finds the parent', () => $('#nested-p').parent().is('.foo-nested'));
            await runTest('.children() finds children', () => $('#test-fixture').children('.foo').length === 1);
            await runTest('.closest() finds an ancestor', () => $('#nested-p').closest('#test-fixture').length === 1);

            await runTest('$.ajax() fetches data successfully', () => {
                return new Promise(resolve => {
                    $.ajax({
                        url: 'https://jsonplaceholder.typicode.com/posts/1',
                        success: (data) => {
                            $('#ajax-target').text(data.title);
                            resolve($('#ajax-target').text() === data.title);
                        },
                        error: () => resolve(false)
                    });
                });
            });

            // Summary
            const summary = $(`<h2>Tests Complete: ${testsPassed} passed, ${testsFailed} failed.</h2>`);
            resultsContainer.append(summary);
        });
    </script>
</body>
</html>
